<div class="card">
  <h2>Pivot Table Raporlama Ekranı</h2>
  <!-- Grup Seçimi -->
  <div class="mb-3">
    <label for="groupBySelect"><strong>Grup Seçimi:</strong></label>
    <!-- <p-dropdown
      id="groupBySelect"
      [options]="groupOptions"
      [(ngModel)]="selectedGroup"
      placeholder="Grup Seçiniz"
      optionLabel="label"
    ></p-dropdown> -->
  </div>

  <!-- Export Butonları -->
  <div class="mb-3">
    <p-button
      label="Export CSV"
      icon="pi pi-file"
      (click)="exportCSV()"
    ></p-button>
    <p-button
      label="Export Excel"
      icon="pi pi-file-excel"
      class="ml-2"
      (click)="exportExcel()"
    ></p-button>
  </div>

  <!-- Rapor Tablosu -->
  <p-table
    #reportTable
    [value]="applications"
    [rowGroupMode]="'subheader'"
    [groupRowsBy]="selectedGroup?.value"
    [sortMode]="'single'"
    [sortField]="selectedGroup?.value"
    [globalFilterFields]="[
      'firstName',
      'lastName',
      'tcNo',
      'phone',
      'income',
      'creditAmount',
      'creditType'
    ]"
  >
    <!-- Grup Başlık Şablonu -->
    <ng-template pTemplate="groupheader" let-rowData let-rowIndex="rowIndex">
      <tr>
        <td colspan="8">
          <strong>{{ selectedGroup?.label }}:</strong>
          <span>
            {{
              selectedGroup?.value === "applicationDate"
                ? (rowData[selectedGroup?.value] | date : "MM/dd/yyyy")
                : rowData[selectedGroup?.value]
            }}
          </span>
          <span class="ml-4"
            >Toplam Başvuru:
            {{ getGroupCount(rowData[selectedGroup?.value]) }}</span
          >
          <span class="ml-4">
            Ortalama Kredi Tutarı:
            {{
              getGroupAverage(rowData[selectedGroup?.value]) | number : "1.0-2"
            }}
          </span>
        </td>
      </tr>
    </ng-template>

    <!-- Sütun Başlıkları -->
    <ng-template pTemplate="header">
      <tr>
        <th>First Name</th>
        <th>Last Name</th>
        <th>TC No</th>
        <th>Phone</th>
        <th>Income</th>
        <th>Credit Amount</th>
        <th>Credit Type</th>
        <th>Application Date</th>
      </tr>
    </ng-template>

    <!-- Satır Şablonu -->
    <ng-template pTemplate="body" let-application>
      <tr>
        <td>{{ application.firstName }}</td>
        <td>{{ application.lastName }}</td>
        <td>{{ application.tcNo }}</td>
        <td>{{ application.phone }}</td>
        <td>{{ application.income }}</td>
        <td>{{ application.creditAmount }}</td>
        <td>{{ application.creditType }}</td>
        <td>{{ application.applicationDate | date : "MM/dd/yyyy" }}</td>
      </tr>
    </ng-template>
  </p-table>
</div>
